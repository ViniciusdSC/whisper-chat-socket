{"version":3,"sources":["../src/index.js"],"names":["app","server","http","createServer","io","port","process","env","PORT","on","client","token","whisper_room_id","user_id","handshake","query","sendMessage","join","message","then","data","status","to","emit","error_code","listen","console","log"],"mappings":";;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;;;AAEA,MAAMA,MAAM,wBAAZ;AACA,MAAMC,SAASC,eAAKC,YAAL,CAAkBH,GAAlB,CAAf;AACA,MAAMI,KAAK,sBAASH,MAAT,CAAX;AACA,MAAMI,OAAOC,QAAQC,GAAR,CAAYC,IAAZ,IAAoB,IAAjC;;AAEAJ,GAAGK,EAAH,CAAM,YAAN,EAAoB,UAAUC,MAAV,EAAkB;AAClC,UAAM,EAAEC,KAAF,EAASC,eAAT,EAA0BC,OAA1B,KAAsCH,OAAOI,SAAP,CAAiBC,KAA7D;AACA,UAAM,EAACC,WAAD,KAAgB,mBAAIL,KAAJ,CAAtB;;AAEAD,WAAOO,IAAP,CAAYL,eAAZ;;AAEAF,WAAOD,EAAP,CAAU,SAAV,EAAqB,UAAUS,OAAV,EAAmB;AACpCF,oBAAY,EAAEH,OAAF,EAAWK,OAAX,EAAZ,EAAkCC,IAAlC,CAAuC,CAAC,EAACC,IAAD,EAAD,KAAY;AAC/C,gBAAIA,KAAKC,MAAT,EAAiB;AACbjB,mBAAGkB,EAAH,CAAMV,eAAN,EAAuBW,IAAvB,CAA4B,SAA5B,EAAuCH,KAAKF,OAA5C;AACH,aAFD,MAEO;AACHR,uBAAOa,IAAP,CAAY,OAAZ,EAAqBH,KAAKI,UAA1B;AACH;AACJ,SAND;AAOH,KARD;AASH,CAfD;;AAiBAvB,OAAOwB,MAAP,CAAcpB,IAAd,EAAoB,YAAW;AAC3BqB,YAAQC,GAAR,CAAa,kBAAiBtB,IAAK,EAAnC;AACH,CAFD","file":"index.js","sourcesContent":["import express from 'express';\r\nimport http from 'http';\r\nimport socketIO from 'socket.io';\r\nimport api from '~/services/api';\r\n\r\nconst app = express();\r\nconst server = http.createServer(app);\r\nconst io = socketIO(server);\r\nconst port = process.env.PORT || 4000;\r\n\r\nio.on('connection', function (client) {\r\n    const { token, whisper_room_id, user_id } = client.handshake.query;\r\n    const {sendMessage} = api(token);\r\n\r\n    client.join(whisper_room_id);\r\n\r\n    client.on('message', function (message) {\r\n        sendMessage({ user_id, message }).then(({data}) => {\r\n            if (data.status) {\r\n                io.to(whisper_room_id).emit('message', data.message);\r\n            } else {\r\n                client.emit('error', data.error_code);\r\n            }\r\n        })\r\n    });\r\n})\r\n\r\nserver.listen(port, function() {\r\n    console.log(`listening on *:${port}`);\r\n});"]}